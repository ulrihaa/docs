# Выделенный хост

_Выделенный хост_ — физический сервер, предназначенный для размещения исключительно ваших виртуальных машин в {{ yandex-cloud }}. ВМ на выделенных хостах обладают всеми возможностями обычных ВМ и дополнительно получают физическую изоляцию от ВМ других пользователей. Вы также можете разделить свои ВМ для разных проектов:

![Dedicated host](../../_assets/compute/dedicated-host.svg "Dedicated host")

Вы можете создать группу, состоящую из одного или нескольких однотипных выделенных хостов. На каждом выделенном хосте вы можете разместить несколько [ВМ разных конфигураций](performance-levels.md), что позволит оптимально использовать ресурсы.

Преимущества выделенных хостов:
* Безопасность работы и соответствие требованиям.
  Вы можете использовать выделенный хост для физической изоляции ВМ в публичном облаке, если этого требуют служба информационной безопасности вашей организации или отраслевые стандарты (например, медицинские или финансовые).
* Использование собственных лицензий.
  Если в вашей организации уже есть лицензии Microsoft или других производителей, требующих привязки к физическим ресурсам, вы можете использовать их в {{ yandex-cloud }} по модели <q>Bring your own license</q> (BYOL).
* Управление размещением ВМ.
  Вы можете самостоятельно выбрать, на каком выделенном хосте запустить ВМ, или разрешить {{ compute-name }} сделать это автоматически.

{% include [dedicated](../../_includes/compute/dedicated-quota.md) %}

Для отказоустойчивости инфраструктуры на выделенных хостах рекомендуется использовать хотя бы два хоста.

## Типы выделенных хостов {#host-types}

Конфигурация выделенного хоста определяется его _типом_. Типы хостов различаются моделью и количеством доступных ядер процессора, объемом RAM, а также количеством и размером локальных SSD-дисков.

Тип выделенного хоста указывается при создании группы хостов. Все хосты в группе будут иметь этот тип, изменить его нельзя.

Количество незанятых выделенных хостов разных типов в каждой [зоне доступности](../../overview/concepts/geo-scope.md) ограничено и меняется со временем. При создании группы хостов или изменении ее размера {{ compute-name }} проверяет, хватает ли имеющихся хостов указанного типа. Если хостов не хватает, вы увидите соответствующую ошибку.


### Список типов {#host-types-list}

Действующий тип — на платформе Intel<sup>®</sup> Ice Lake

: Тип и процессор<br>(платформа Ice Lake) | Процессоры | Ядра | vCPU^1^ | RAM, ГБ | Диски | Размер диска
  --- | --- | --- | --- | --- | --- | ---
  `intel-6338-c108-m704-n3200x6`<br>[Intel<sup>®</sup> Xeon<sup>®</sup> Gold 6338](https://ark.intel.com/content/www/ru/ru/ark/products/212285/intel-xeon-gold-6338-processor-48m-cache-2-00-ghz.html) | 2 | 64 | 108 | 704 | 6 | 3198924357632 Б <br>(~ 2,91 ТБ)

  
  Хосты этого типа можно создавать только в зонах доступности `{{ region-id }}-a` и `{{ region-id }}-b`. Подробнее см. в разделе [{#T}](../../overview/concepts/ru-central1-c-deprecation.md).
  

{% cut "Архивные типы — на платформе Intel Cascade Lake" %}

{% note alert %}

Не создавайте выделенные хосты архивных типов. Используйте только действующий тип (см. выше).

{% endnote %}

Тип и процессор<br>(платформа Cascade Lake) | Процессоры | Ядра | vCPU^1^ | RAM, ГБ | Диски | Размер диска
--- | --- | --- | --- | --- | --- | ---
`intel-6230-c66-m454`<br>[Intel Xeon Gold 6230](https://ark.intel.com/content/www/ru/ru/ark/products/192437/intel-xeon-gold-6230-processor-27-5m-cache-2-10-ghz.html) | 2 | 40 | 66 | 454 | 4 | 1600 × 10^9^ Б <br>(~ 1,46 ТБ)
`intel-6230-c66-m704-n1600x4`<br>Intel Xeon Gold 6230 | 2 | 40 | 66 | 704 | 4 | 1600 × 10^9^ Б <br>(~ 1,46 ТБ)
`intel-6230r-c84-m328-n3200x4`<br>[Intel Xeon Gold 6230R](https://ark.intel.com/content/www/ru/ru/ark/products/199346/intel-xeon-gold-6230r-processor-35-75m-cache-2-10-ghz.html) | 2 | 52 | 84 | 328 | 4 | 3198924357632 Б <br>(~ 2,91 ТБ)
`intel-6230r-c84-m454-n3200x4`<br>Intel Xeon Gold 6230R | 2 | 52 | 84 | 454 | 4 | 3198924357632 Б <br>(~ 2,91 ТБ)

{% endcut %}

Списки действующих и архивных типов выше — примерные и могут меняться. Получить актуальный список типов (без деления на действующие и архивные) можно:

* в [консоли управления]({{ link-console-main }}) на странице создания группы выделенных хостов в {{ compute-name }};
* с помощью команды CLI:

    ```bash
    yc compute host-type list
    ```

    Подробнее см. в [инструкции по созданию группы](../operations/dedicated-host/create-host-group.md).

^1^ Указано количество vCPU, на которых вы можете запускать ВМ. Остальные vCPU хоста выделены для системного потребления (подробнее см. [ниже](#resource-fragmentation)): на процессорах Intel Xeon Gold 6230 — 14 vCPU, на процессорах Intel Xeon Gold 6230R и Intel Xeon Gold 6338 — 20 vCPU.

## Использование физических ресурсов хоста {#resource}

### Фрагментация процессоров {#resource-fragmentation}

На физическом сервере установлено два процессора. Однако не все ядра процессоров доступны для запуска ВМ. Часть ядер выделены для системного потребления.

Например, у выделенного хоста с двумя процессорами Intel Xeon Gold 6230 для запуска ВМ доступны 66 vCPU (34 на первом процессоре и 32 на втором). Оставшиеся 14 vCPU (6 + 8) используются системой.

При создании ВМ на выделенном хосте вы можете столкнуться с фрагментацией ресурсов: при наличии необходимого количества свободных vCPU невозможно запустить ВМ. Например, на выделенном хосте с 66 vCPU вы можете запустить только 10 ВМ по 6 vCPU.

![Resource fragmentation](../../_assets/compute/resource-fragmentation.svg "Resource fragmentation")

В этом случае для полной утилизации vCPU выделенного хоста можно запустить две ВМ с 2 и 4 vCPU.

### Локальные и сетевые диски {#resource-disks}

На каждом выделенном хосте доступно несколько локальных дисков. Их количество и объем зависят от выбранной конфигурации хоста (см. [выше](#host-types)).

К ВМ на выделенных хостах можно подключать сетевые и локальные диски. Конфигурация должна отвечать следующим требованиям:

* Загрузочным диском ВМ должен быть сетевой диск. Локальные диски могут быть только дополнительными.
* Все сетевые диски должны находиться в той же зоне доступности, что и группа выделенных хостов.
* Локальный диск можно подключить к ВМ только целиком. Например, при подключении диска к ВМ на хосте типа `intel-6338-c108-m704-n3200x6` нужно указать точный размер диска — `3198924357632`.
* Один диск может быть подключен только к одной ВМ.

При работе с локальными дисками, подключенными к ВМ на выделенных хостах, нельзя:

* Изменять RAM и CPU существующей ВМ. Для изменения этих параметров нужно пересоздать ВМ.
* Подключать к ВМ дополнительные сетевые диски, если она остановлена (`stopped`). Для подключения дополнительных сетевых дисков ВМ должна быть [запущена](../operations/vm-control/vm-stop-and-start.md#start).
* Подключать к ВМ дополнительные локальные диски, а также удалять уже подключенные. Для изменения состава подключенных локальных дисков нужно пересоздать ВМ. Подробнее о создании ВМ с локальными дисками на выделенных хостах в [инструкциях](../operations/index.md#dedicated-host).

При выходе из строя выделенного хоста данные на локальных дисках будут потеряны. Для сохранности данных самостоятельно настройте репликацию, например, с помощью [{{ backup-full-name }}](../../backup/concepts/index.md).

## Размер группы хостов {#host-group-size}

При создании группы хостов необходимо указать количество выделенных хостов. При изменении группы вы можете уменьшить или увеличить количество хостов в группе:

```
yc compute host-group create \
  --fixed-size <количество_хостов> \
  ...
```

## Техническое обслуживание {#maintenance}

{{ compute-name }} проводит периодическое техническое обслуживание хостов. Некоторые виды обслуживания проходят в фоновом режиме и не влияют на работу пользователей. Другие виды требуют освобождения хоста от ВМ. При необходимости такого обслуживания:

* В группу хостов добавляется новый (подменный) хост.
* Вычисляется дата автоматического освобождения старого хоста.

Идентификаторы `host-id` и `server-id` нового хоста и дату автоматического освобождения можно узнать в [консоли управления]({{ link-console-main }}) на странице **{{ ui-key.yacloud.compute.host-group.hosts.label_title }}**, а также с помощью команды [CLI](../../cli/quickstart.md):

```bash
yc compute host-group list-hosts <идентификатор_группы_хостов>
```

Результат:

```
+----------------------+----------------------+----------------------+--------------------------+
|          ID          |      SERVER ID       | REPLACEMENT HOST ID  |   REPLACEMENT DEADLINE   |
+----------------------+----------------------+----------------------+--------------------------+
| fhm1ab2mhnf3******** | fhmlabct12vp******** | fhmabcun12kb******** | 2023-10-24T12:36:14.321Z |
| fhmabcun12kb******** | fhm1a2bcsl13******** |                      |                          |
+----------------------+----------------------+----------------------+--------------------------+
```

Где:

* `REPLACEMENT HOST ID` — идентификатор нового (подменного) хоста.
* `REPLACEMENT DEADLINE` — дата и время автоматического освобождения хоста (UTC).

Выводимый в обслуживание хост не тарифицируется, не учитывается в размере хостгруппы и не используется для размещения вновь запускаемых ВМ.

Дата и время автоматического освобождения устанавливаются на седьмые сутки с момента выделения подменного хоста. {{ compute-name }} начнет автоматическое освобождение хоста в период с `<REPLACEMENT DEADLINE>` до `<REPLACEMENT DEADLINE> + 1 час`. В зависимости от типа ВМ:

* ВМ без локальных дисков, GPU и [привязки](#bind-vm) к `host-id` будут перемещены [динамической миграцией](live-migration.md).
* ВМ с привязкой к `host-id` будут остановлены. Вам потребуется убрать привязку к хосту либо обновить ее на новый `host-id`, после чего запустить ВМ.
* ВМ с локальными дисками сначала будут остановлены, а через 12 часов переведены в статус `ERROR` с очисткой локальных дисков.

Дата автоматического освобождения может быть перенесена как вперед, так и назад, максимум на 21 сутки с момента выделения подменного хоста. Вы можете изменить дату с помощью команды:

```bash
yc compute host-group update-host <идентификатор_группы_хостов> \
  --host-id <идентификатор_хоста> \
  --replacement-deadline <дедлайн>
```

Где `--replacement-deadline` — дата и время в формате UTC `YYYY-MM-DDTHH:MM:SSZ`.

Автоматическое перемещение ВМ происходит согласно правилам привязки ВМ. ВМ будет перемещена на любой хост в группе хостов с достаточным количеством ресурсов, включая подменный хост. При отсутствии ресурсов ВМ будут остановлены.

Вы можете самостоятельно перенести ВМ со старого хоста до указанной даты:

* [Динамической миграцией](live-migration.md) — для этого обратитесь в [техническую поддержку]({{ link-console-support }}).
* [Остановкой и последующим запуском](../operations/vm-control/vm-stop-and-start.md) в [консоли управления]({{ link-console-main }}) или с помощью команд CLI:

    ```bash
    yc compute instance stop <имя_ВМ>
    ```

    ```bash
    yc compute instance start <имя_ВМ>
    ```

* [Удалением](../operations/vm-control/vm-delete.md) и [пересозданием](../operations/vm-create/create-linux-vm.md) (для ВМ с локальными дисками).

Выделенный хост, на котором фактически запущена ВМ, можно узнать с помощью команды:

```bash
yc compute instance get <имя_ВМ>
```

Результат:

```
...
host_id: <идентификатор_хоста>
```

## Неисправности хостов {#malfunctions}

Если физический сервер перезагружен, работающие на нем ВМ будут автоматически перезапущены с [привязкой](#bind-vm):

* К той же группе хостов, если ВМ была привязана к группе. При этом возможна привязка к другому хосту группы.
* К выделенному хосту, если ВМ была привязана к конкретному хосту.

Если физический сервер полностью остановлен, {{ compute-name }}:

* Удаляет физический сервер из хост-группы.
* Заменяет вышедший из строя сервер на новый (с новым идентификатором `server-id`). Идентификаторы группы хостов (`host-group-id`) и выделенного хоста (`host-id`) при этом сохраняются.
* Запускает ВМ с вышедшего из строя сервера по правилам привязки ВМ. При этом ВМ без локальных дисков запускаются автоматически, а ВМ с локальными дисками переходят в статус `ERROR`. Содержимое локальных дисков с неисправного сервера на новый не переносится.

## Привязка виртуальной машины к группе или хосту {#bind-vm}

Чтобы однозначно сопоставить ВМ и физический сервер, вы можете создать ВМ с привязкой:
* К группе выделенных хостов.
  При остановке ВМ она будет недоступна на хостах группы, а при последующем перезапуске может быть привязана к другому хосту из группы.
* К выбранному хосту из группы.
  При остановке ВМ она будет недоступна на хосте, а при последующем перезапуске будет привязана к этому же хосту из группы.

Привязка ВМ гарантирует, что ВМ будет запущена на одном и том же физическом сервере или группе серверов даже после плановых перерывов в работе.

Чтобы переместить ВМ между выделенными хостами, необходимо:
1. [Остановить ВМ](../operations/vm-control/vm-stop-and-start).
1. Привязать ВМ к другому хосту из группы.
1. Перезапустить ВМ.

При создании ВМ вы можете указать несколько групп хостов или конкретных хостов, к которым она может быть привязана. Пример привязки к одной из групп хостов:

```
yc compute instance create \
  --host-group-id <идентификатор_группы_хостов> \
  --network-interface subnet-name=default-{{ region-id }}-a \
  --zone {{ region-id }}-a
```

В этом случае ВМ будет привязана к указанной группе хостов:

```
done (33s)
id: abcdefghigkl********
folder_id: a1b23cd45efg********
...
placement_policy:                             # Правила привязки ВМ
  host_affinity_rules:
    - key: yc.hostGroupId
      op: IN
      values:
        - <идентификатор_группы_хостов>
host_group_id: <идентификатор_группы_хостов>  # Фактическое расположение ВМ
host_id: <идентификатор_хоста>                # Фактическое расположение ВМ
...
```

Правила в `host_affinity_rules` объединяются через `ИЛИ`. Например, следующие правила разрешают запускать ВМ на любом хосте группы `host_group_id` или на хосте `host_id`:

```
placement_policy:
  host_affinity_rules:
    - key: yc.hostGroupId
      op: IN
      values:
        - <идентификатор_группы_хостов>
    - key: yc.hostId
      op: IN
      values:
        - <идентификатор_хоста>
```

## Группы размещения {#placement-groups}

Не рекомендуется использовать [группы размещения](placement-groups.md) для ВМ на выделенных хостах.

## Тарификация {#billing}

Тарифы на использование выделенных хостов описаны на странице [{#T}](../pricing.md#prices-dedicated-host).

_Intel и Xeon являются товарными знаками корпорации Intel или ее подразделений._