# Резервные копии в {{ mgp-name }}

{{ mgp-short-name }} обеспечивает автоматическое резервное копирование баз данных.

{{ mgp-short-name }} позволяет вернуть состояние кластера _на точку восстановления_, в которой данные консистентны (Point-in-Time-Recovery, PITR). Точки восстановления создаются раз в час. Если задать время восстановления, будет использована ближайшая точка, созданная до этого времени. При восстановлении выбранной резервной копии кластера ее данные будут дополняться записями из журналов WAL (Write-Ahead Log) до ближайшей точки восстановления включительно.

Например, если создание резервной копии завершилось 10.11.2022 в 12:00:00 UTC, текущая дата — 15.11.2022 19:00:00 UTC, а последняя точка восстановления была создана 15.11.2022 в 18:00:00 UTC, кластер может быть восстановлен в любую точку восстановления в промежутке времени с 10.11.2022 12:00:01 UTC до 15.11.2022 18:00:00 UTC включительно. Если указать время восстановления 15.11.2022 17:30:00 UTC, то кластер будет восстановлен на точку восстановления 15.11.2022 17:00:00 UTC.

По умолчанию режим PITR включен.

Чтобы восстановить кластер из резервной копии, [следуйте инструкциям](../operations/cluster-backups.md#restore). Вы также можете восстановить кластер, чтобы перенести его хосты в другую зону доступности. Это может понадобиться, например, если ваши хосты размещаются в зоне `{{ region-id }}-c`, которая [выводится из эксплуатации](/blog/posts/2023/08/new-availability-zone).

## Создание резервной копии {#size}

Первая и каждая седьмая резервные копии — полные резервные копии всех баз данных. Остальные резервные копии — инкрементные, хранится только разница с предыдущей резервной копией, что позволяет экономить место в хранилище.

Резервная копия всех данных кластера автоматически создается раз в день. Создать резервную копии вручную невозможно, как и отключить автоматическое создание резервной копии. Однако при [создании](../operations/cluster-create.md) или [изменении](../operations/update.md#change-additional-settings) кластера для таких резервных копий можно задать время начала резервного копирования. По умолчанию время начала — 22:00 UTC (Coordinated Universal Time). Резервное копирование начнется в течение получаса от указанного времени.

После создания резервная копия сжимается для дальнейшего хранения. Отображение точного размера резервной копии недоступно.

Резервные копии создаются только на работающих кластерах. Если вы используете кластер {{ mgp-short-name }} не круглосуточно, проверьте [настройки времени начала резервного копирования](../operations/update.md#change-additional-settings).

Чтобы восстановить кластер из резервной копии, [следуйте инструкциям](../operations/cluster-backups.md#restore).

## Хранение резервной копии {#storage}

Особенности хранения резервных копий в {{ mgp-name }}:

* Резервные копии хранятся в объектном хранилище в виде бинарных файлов и шифруются с помощью [GPG](https://ru.wikipedia.org/wiki/GnuPG). У каждого кластера свои ключи шифрования.

* {% include [backup-wal](../../_includes/mdb/mgp/backup-wal.md) %}

* Резервные копии хранятся 7 дней.

* После удаления кластера все его резервные копии хранятся 7 дней.

* {% include [no-quotes-no-limits](../../_includes/mdb/backups/no-quotes-no-limits.md) %}

## Проверка восстановления из резервной копии {#capabilities}

Для проверки возможностей резервного копирования [восстановите кластер из резервной копии](../operations/cluster-backups.md#restore) и проверьте целостность ваших данных.

{% include [greenplum-trademark](../../_includes/mdb/mgp/trademark.md) %}
