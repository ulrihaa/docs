---
name: "Инструкция по копированию объектов из бакета {{ objstorage-full-name }}"
description: "Из статьи вы узнаете, как скопировать объекты из бакета в {{ objstorage-full-name }}."
---

# Копирование объектов

В {{ objstorage-name }} поддерживается копирование объектов на стороне сервера (_Server Side Copy_). 

Если в [бакете](../../concepts/bucket.md) отключено [шифрование](../../concepts/encryption.md), то [объекты](../../concepts/object.md) будут копироваться в бакеты на стороне сервера. Хост, на котором выполняется команда копирования, и {{ objstorage-name }} обмениваются только [ключами](../../concepts/object.md#key) объектов. Плата за трафик при копировании в таком случае не взимается, поскольку он является внутренним для объектного хранилища. При этом сами запросы на копирование [тарифицируются](../../pricing.md#prices-operations).

Если объекты в бакете зашифрованы, то сначала они будут скопированы на хост, выполняющий команду, и после загружены в бакет-приемник.

Большие объекты, загруженные с помощью [составной загрузки](../../concepts/multipart.md), хранятся в бакете частями. Копирование таких объектов происходит путем вызова [copyPart](../../s3/api-ref/multipart/copypart.md) для каждой его части. Таким образом, расходы при копировании составных объектов выше, чем при копировании обычных.

Вы можете скопировать как [все содержимое бакета](#copy-from-bucket-to-bucket), так и [отдельный его объект](#copy-single-object). Также доступно копирование объектов между [бакетами разных организаций](#copy-to-another-org-bucket).

## Копирование одного объекта {#copy-single-object}

{% list tabs %}

- AWS CLI

  1. Если у вас еще нет AWS CLI, [установите и сконфигурируйте его](../../tools/aws-cli.md).
  1. Выполните команду:

      ```bash
      aws --endpoint-url=https://{{ s3-storage-host }}/ \
        s3 cp s3://<бакет_источник>/<ключ_объекта> s3://<бакет_приемник>/<ключ_объекта>
      ```

      Где:

      * `--endpoint-url` — эндпоинт {{ objstorage-name }}.
      * `s3 cp` — команда для копирования объектов.

      Результат:

      ```text
      copy: s3://<бакет_источник>/<ключ_объекта> to s3://<бакет_приемник>/<ключ_объекта>
      ```

      Подробнее о команде `aws s3 cp` см. в документации [AWS CLI Command Reference](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3/cp.html).
  
{% endlist %}

## Копирование всех объектов бакета в другой бакет {#copy-from-bucket-to-bucket}

{% list tabs %}

- AWS CLI

  1. Если у вас еще нет AWS CLI, [установите и сконфигурируйте его](../../tools/aws-cli.md).
  1. Выполните команду:

      ```bash
      aws --endpoint-url=https://{{ s3-storage-host }}/ \
        s3 cp --recursive s3:<бакет_источник>/ s3:<бакет_приемник>/
      ```

      Где:

      * `--endpoint-url` — эндпоинт {{ objstorage-name }}.
      * `s3 cp` — команда для копирования объектов.
      * `--recursive` — параметр для копирования всех объектов бакета-источника.

      Подробнее о команде `aws s3 cp` см. в документации [AWS CLI Command Reference](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3/cp.html).

  Все объекты будут скопированы из бакета-источника в бакет-приемник. 

  {% note info %}

  Вы можете скопировать объекты между бакетами, как в рамках одного облака, так и между разными облаками. Для этого убедитесь, что у используемого [сервисного аккаунта](../../../iam/concepts/users/service-accounts.md) есть права на запись в оба бакета.

  {% endnote %}

{% endlist %}

## Копирование объектов в бакет другой организации {#copy-to-another-org-bucket}

Чтобы скопировать объекты в бакет другой [организации](../../../overview/roles-and-resources.md), [создайте](../../../iam/operations/sa/create.md) два сервисных аккаунта: один с ролью [`storage.viewer`](../../security/index.md#storage-viewer) на бакет-источник, а второй — с ролью [`storage.editor`](../../security/index.md#storage-editor) на бакет-приемник.

{% list tabs %}

- AWS CLI

  1. Если у вас еще нет AWS CLI, [установите и сконфигурируйте его](../../tools/aws-cli.md) для каждой из организаций.
  1. Задайте [список управления доступом](../../concepts/acl.md) бакета-приемника с полным доступом для сервисного аккаунта исходного бакета:

      ```bash
      aws --endpoint-url=https://{{ s3-storage-host }}/ \
        s3api --profile <путь_к_конфигурационному_файлу_бакета-приемника> \
        --bucket <имя_бакета_приемника> \
        --grant-full-control id=<идентификатор_сервисного_аккаунта_бакета-источника>
      ```

      Где:

      * `--endpoint-url` — эндпоинт {{ objstorage-name }}.
      * `--profile` — путь к [конфигурационному файлу](../../tools/aws-cli.md#config-files) AWS CLI для организации, в которой находится бакет-приемник.
      * `--bucket` — имя бакета-приемника.
      * `--grant-full-control` — параметр для выдачи доступа сервисному аккаунту бакета-источника к бакету-приемнику.

  1. Скопируйте объект:

      ```bash
      aws --endpoint-url=https://{{ s3-storage-host }}/ \
        s3 cp --profile <путь_к_конфигурационному_файлу_бакета-источника> \
        s3://<бакет_источник>/<ключ_объекта> \
        s3://<бакет_приемник>/<ключ_объекта>
      ```

      Где:

      * `--endpoint-url` — эндпоинт {{ objstorage-name }}.
      * `--profile` — путь к конфигурационному файлу AWS CLI для организации, в которой находится бакет-приемник.
      * `s3 cp` — команда для копирования объектов.
      
      Чтобы скопировать все объекты бакета-источника, используйте параметр `--recursive`.

      Результат:

      ```text
      copy: s3://<бакет_источник>/<ключ_объекта> to s3://<бакет_приемник>/<ключ_объекта>
      ```

      Подробнее о команде `aws s3 cp` см. в документации [AWS CLI Command Reference](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3/cp.html).

{% endlist %}
